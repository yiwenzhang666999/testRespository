define(["map","style","treeHelper"],function(f,a,b){var e;var i;var h=false;var c=false;function j(l,n){var o=f.getMap();if(!e){e=f.getLayerByName("DRAW_LAYER")}var m=e.getSource();m.clear();d();i=new ol.interaction.Draw({source:m,type:l,snapTolerance:5,style:a.getDefaultStyleFunction()});o.addInteraction(i);i.on("drawend",function(p){setTimeout(function(){e.getSource().clear()},0);if(h){h=false;return}o.render();o.removeInteraction(i);i=null;n(p)})}function k(n,o){var m=b.getTree("zyjg");var l=m.getCheckedNodes();for(var p=0;p<l.length;p++){var q=l[p];if(q._data&&q._data.xian&&q._data.xian==n){return 1}}return 0}function d(){var l=f.getMap().getInteractions().getArray();for(var m=0;m<l.length;m++){if(l[m] instanceof ol.interaction.Draw||l[m] instanceof ol.interaction.Select){f.getMap().removeInteraction(l[m]);i=null}}f.getLayerByName("BUFFER_LAYER").getSource().clear()}function g(){if(i&&i.a&&i.a&&i.a[0].length>1){i.removeLastPoint()}else{if(i&&i.sketchCoords_&&i.sketchCoords_&&i.sketchCoords_[0].length>1){i.removeLastPoint()}}}ol.interaction.Draw.prototype.clearOverlay_=function(){this.overlay_.getSource().clear()};ol.interaction.Draw.prototype.atFinish_=function(m){var o=false;if(this.sketchFeature_){var s=false;var u=[this.finishCoordinate_];if(this.mode_===ol.interaction.Draw.Mode_.LINE_STRING){s=this.sketchCoords_.length>this.minPoints_}else{if(this.mode_===ol.interaction.Draw.Mode_.POLYGON){s=this.sketchCoords_[0].length>this.minPoints_;u=[this.sketchCoords_[0][0],this.sketchCoords_[0][this.sketchCoords_[0].length-2]]}}if(s){var l=m.map;for(var q=0,v=u.length;q<v;q++){var r=u[q];var p=l.getPixelFromCoordinate(r);var n=m.pixel;var x=n[0]-p[0];var w=n[1]-p[1];if(q==0){var t=this.freehand_?5:this.snapTolerance_;o=Math.sqrt(x*x+w*w)<=t}else{if(q==1){o=Math.sqrt(x*x+w*w)<=0.01}}if(o){this.finishCoordinate_=r;break}}}}return o};return{draw:j,removeLastPoint:g,clear:d}});