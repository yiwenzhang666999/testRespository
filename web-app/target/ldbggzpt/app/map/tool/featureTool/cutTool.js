define(["map","drawMap","publicObj","config"],function(c,k,g,f){var e=new ol.format.WKT();var d=new jsts.io.WKTReader();var l=new jsts.io.OL3Parser();var h;var j;var i;var m;var b=f.publicService+"/geometry/cut.do";function a(o,p,n){if(o==h){return}if(o){p.setStyle(g.selectStyle);var q=function(s){var u=s.feature;var t=p;var r=e.writeFeature(u);var w=e.writeFeature(p);var v={geoWkt:w,lineWkt:r,tolerance:"0"};$.ajax({url:b,type:"POST",data:{data:JSON.stringify(v)},success:function(A){if(A.result){$("#map").removeClass("noTrack");var x=A.data;var B=[];for(var z=0;z<x.length;z++){var y=e.readFeature(x[z]);B.push(y)}n(B)}},error:function(x){if(x){util.validateSession(x);console.error(x)}}})};k.draw("LineString",q);$("#map").addClass("noTrack")}else{k.clear()}h=o}return{setActive:a}});