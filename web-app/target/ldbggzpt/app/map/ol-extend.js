ol.interaction.drawBuffer=function(a){ol.interaction.Draw.call(this,a);this.bufferTolerance_=a.bufferTolerance?a.bufferTolerance:false;this.bufferLayerName_=a.bufferLayerName?a.bufferLayerName:false;this.isBuffer=a.isBuffer?a.isBuffer:false;this.lastPixel=[0,0];this.pointFeatures=[];var b=new ol.style.Style({image:new ol.style.Circle({radius:4,stroke:new ol.style.Stroke({color:"rgba(70,70,70,1)",width:1}),fill:new ol.style.Fill({color:"rgba(255,255,255,1)"})})});this.pointlay_=new ol.layer.Vector({source:new ol.source.Vector({useSpatialIndex:false,wrapX:a.wrapX?a.wrapX:false}),style:b})};ol.interaction.drawBuffer.prototype=Object.create(ol.interaction.Draw.prototype);ol.interaction.drawBuffer.prototype.constructor=ol.interaction.drawBuffer;ol.interaction.drawBuffer.prototype.clearOverlay_=function(){this.overlay_.getSource().clear();this.pointlay_.getSource().clear()};ol.interaction.drawBuffer.prototype.startDrawing_=function(a){var c=a.coordinate;this.finishCoordinate_=c;if(this.mode_===ol.interaction.Draw.Mode_.POINT){this.sketchCoords_=c.slice()}else{if(this.mode_===ol.interaction.Draw.Mode_.POLYGON){this.sketchCoords_=[[c.slice(),c.slice()]];this.sketchLineCoords_=this.sketchCoords_[0]}else{this.sketchCoords_=[c.slice(),c.slice()];if(this.mode_===ol.interaction.Draw.Mode_.CIRCLE){this.sketchLineCoords_=this.sketchCoords_}}}if(this.sketchLineCoords_){this.sketchLine_=new ol.Feature(new ol.geom.LineString(this.sketchLineCoords_))}var b=this.geometryFunction_(this.sketchCoords_);this.sketchFeature_=new ol.Feature();if(this.geometryName_){this.sketchFeature_.setGeometryName(this.geometryName_)}this.sketchFeature_.setGeometry(b);this.updateSketchFeatures_();this.showPoint(a.coordinate.slice());this.dispatchEvent(new ol.interaction.Draw.Event(ol.interaction.DrawEventType.DRAWSTART,this.sketchFeature_))};ol.interaction.drawBuffer.prototype.addToDrawing_=function(b){var e=b.coordinate;var d=(this.sketchFeature_.getGeometry());var a;var c;if(this.mode_===ol.interaction.Draw.Mode_.LINE_STRING){this.finishCoordinate_=e.slice();c=this.sketchCoords_;if(c.length>=this.maxPoints_){if(this.freehand_){c.pop()}else{a=true}}c.push(e.slice());this.geometryFunction_(c,d)}else{if(this.mode_===ol.interaction.Draw.Mode_.POLYGON){c=this.sketchCoords_[0];if(c.length>=this.maxPoints_){if(this.freehand_){c.pop()}else{a=true}}c.push(e.slice());if(this.freehand_){this.showPoint(e.slice())}if(a){this.finishCoordinate_=c[0]}this.geometryFunction_(this.sketchCoords_,d)}}this.updateSketchFeatures_();if(a){this.finishDrawing()}};ol.interaction.drawBuffer.prototype.showPoint=function(c){var a=new ol.geom.Point(c);var b=new ol.Feature({geometry:a});var d=new ol.style.Style({image:new ol.style.Circle({radius:4,stroke:new ol.style.Stroke({color:"rgba(70,70,70,1)",width:1}),fill:new ol.style.Fill({color:"rgba(255,255,255,1)"})})});b.setStyle(d);this.pointFeatures.push(b);this.pointlay_.getSource().addFeature(b)};ol.interaction.drawBuffer.prototype.updateSketchFeatures_=function(){var b=[];if(this.sketchFeature_){b.push(this.sketchFeature_)}if(this.sketchLine_){b.push(this.sketchLine_)}if(this.sketchPoint_){b.push(this.sketchPoint_)}var a=this.overlay_.getSource();a.clear(true);a.addFeatures(b)};ol.interaction.drawBuffer.prototype.atFinish_=function(b){var d=false;if(this.sketchFeature_){var h=false;var k=[this.finishCoordinate_];if(this.mode_===ol.interaction.Draw.Mode_.LINE_STRING){h=this.sketchCoords_.length>this.minPoints_}else{if(this.mode_===ol.interaction.Draw.Mode_.POLYGON){h=this.sketchCoords_[0].length>this.minPoints_;k=[this.sketchCoords_[0][0],this.sketchCoords_[0][this.sketchCoords_[0].length-2]]}}if(h){var a=b.map;for(var f=0,l=k.length;f<l;f++){var g=k[f];var e=a.getPixelFromCoordinate(g);var c=b.pixel;var n=c[0]-e[0];var m=c[1]-e[1];if(f==0){var j=this.freehand_?5:this.snapTolerance_;d=Math.sqrt(n*n+m*m)<=j}else{if(f==1){d=Math.sqrt(n*n+m*m)<=0.01}}if(d){this.finishCoordinate_=g;break}}}}return d};ol.interaction.drawBuffer.prototype.getInflectionPoint=function(){var f=[];var k=[];if(this.mode_===ol.interaction.Draw.Mode_.POINT){}else{if(this.mode_===ol.interaction.Draw.Mode_.LINE_STRING){k=this.sketchCoords_}else{if(this.mode_===ol.interaction.Draw.Mode_.POLYGON){k=this.sketchCoords_[0]}else{if(this.mode_===ol.interaction.Draw.Mode_.CIRCLE){}else{}}}}var b=k.length;for(var e=0;e<b;e++){var j=k[e];if(!f.isHaveArr(j)){f.push(j)}}var d=[];for(var c=0;c<f.length;c++){var h=new ol.geom.Point(f[c]);var g=new ol.Feature({geometry:h});var a=new ol.style.Style({image:new ol.style.Circle({radius:4,stroke:new ol.style.Stroke({color:"rgba(70,70,70,1)",width:1}),fill:new ol.style.Fill({color:"rgba(255,255,255,1)"})})});g.setStyle(a);d.push(g)}return d};ol.interaction.Draw.prototype.removeLastPoint=function(){if(!this.sketchFeature_){return}var e=(this.sketchFeature_.getGeometry());var d,b;if(this.mode_===ol.interaction.Draw.Mode_.LINE_STRING){d=this.sketchCoords_;d.splice(-2,1);this.geometryFunction_(d,e);if(d.length>=2){this.finishCoordinate_=d[d.length-2].slice()}}else{if(this.mode_===ol.interaction.Draw.Mode_.POLYGON){d=this.sketchCoords_[0];if(lastFPoints.length>0){d.splice(-1-lastFPoints.length,lastFPoints.length)}else{d.splice(-2,1)}b=(this.sketchLine_.getGeometry());b.setCoordinates(d);this.geometryFunction_(this.sketchCoords_,e);if(lastFPoints.length>0){var a=this.pointFeatures.splice(-lastFPoints.length,lastFPoints.length);for(var c=0;c<a.length;c++){this.pointlay_.getSource().removeFeature(a[c])}lastFPoints=[]}else{if(this.pointFeatures.length>0){this.pointlay_.getSource().removeFeature(this.pointFeatures.pop())}}}}if(d.length===0){this.finishCoordinate_=null}this.updateSketchFeatures_()};ol.interaction.drawBuffer.prototype.updateState_=function(){var b=this.getMap();var a=this.getActive();if(!b||!a){this.abortDrawing_()}this.overlay_.setMap(a?b:null);this.pointlay_.setMap(a?b:null)};ol.interaction.Draw.prototype.abortDrawing_=function(){this.finishCoordinate_=null;var b=this.sketchFeature_;if(b){this.sketchFeature_=null;this.sketchPoint_=null;this.sketchLine_=null;this.overlay_.getSource().clear(true)}if(this.pointFeatures){this.pointFeatures=[];this.pointlay_.getSource().clear()}var a=map.getLayerByName("BUFFER_LAYER");if(a){a.getSource().clear()}return b};ol.interaction.drawBuffer.prototype.showPoints=function(d){var e=new ol.style.Style({image:new ol.style.Circle({radius:4,stroke:new ol.style.Stroke({color:"rgba(70,70,70,1)",width:1}),fill:new ol.style.Fill({color:"rgba(255,255,255,1)"})})});for(var c=0;c<d.length;c++){var a=new ol.geom.Point(d[c]);var b=new ol.Feature({geometry:a});b.setStyle(e);this.pointFeatures.push(b);this.pointlay_.getSource().addFeature(b)}};Array.prototype.isHaveArr=function(a){for(var b=0;b<this.length;b++){if(this[b].indexOf(a[0])>0&&this[b].indexOf(a[1])>0){return true}}return false};document.onkeydown=function(a){var c=a||window.event;var b=c.keyCode||c.which;if(b==81){$(".is-buffer-snap i").click()}};