define(["config","layerFactory"],function(p,k){var o="map";var q;var f={};var d={};var s="EPSG:"+p.MAP.WKID;var r=new ol.proj.Projection({code:s,extent:p.MAP.EXTENT});function n(){i();m();l()}function i(){var t=new ol.View({center:p.MAP.CENTER,zoom:p.MAP.ZOOM,maxZoom:p.MAP.MAXZOOM,minZoom:p.MAP.MINZOOM,projection:r});q=new ol.Map({target:o,view:t,logo:false,loadTilesWhileAnimating:true})}function m(){var w=function(J){var I=k.getLayer(J);f[J.TABLENAME]=I;q.addLayer(I);if(J.GROUP){for(var L=0;L<J.GROUP.length;L++){var M=J.GROUP[L];var K=k.getLayer(M);f[M.TABLENAME]=K;q.addLayer(K)}}};var v=p.LAYER;for(var z=0;z<v.length;z++){w(v[z])}var D=k.get_high_layer();var x=k.get_draw_layer();var C=k.get_edit_layer();var F=k.get_create_layer();var y=k.get_zqdw_layer();var B=k.get_buffer_layer();var u=k.get_shdk_wwc_layer();var H=k.get_shdk_high_layer();var G=k.get_shdk_ywc_layer();var A=k.get_shdk_p_ywc_layer();var E=k.get_shdk_p_wwc_layer();var t=k.get_attrQuery_layer();f.HIGH_LAYER=D;q.addLayer(D);f.DRAW_LAYER=x;q.addLayer(x);f.EDIT_LAYER=C;q.addLayer(C);f.CREATE_LAYER=F;q.addLayer(F);f.ZQDW_LAYER=y;q.addLayer(y);f.BUFFER_LAYER=B;q.addLayer(B);f.SHDK_WWC_LAYER=u;q.addLayer(u);f.SHDK_HIGH_LAYER=H;q.addLayer(H);f.SHDK_YWC_LAYER=G;q.addLayer(G);f.SHDK_P_YWC_LAYER=A;q.addLayer(A);f.SHDK_P_WWC_LAYER=E;q.addLayer(E);f.ATTRQUERY_LAYER=t;q.addLayer(t)}function l(){q.addControl(new ol.control.ScaleLine({units:"metric"}));var t=new ol.control.MousePosition({coordinateFormat:ol.coordinate.createStringXY(2),projection:s,className:"custom-mouse-position",target:document.getElementById("mouse-position"),undefinedHTML:"&nbsp;"});q.addControl(t)}function a(t){return f[t]}function g(){return q}function h(v,u){if(u){f[v].setVisible(true)}else{var t=e(v);for(var w=0;w<t.length;w++){f[t[w]].setVisible(true)}}}function j(v,u){if(u){f[v].setVisible(false)}else{var t=e(v);for(var w=0;w<t.length;w++){f[t[w]].setVisible(false)}}}function e(t){var x=[];var w=p.LAYER;for(var u=0;u<w.length;u++){var v=w[u];if(v.TABLENAME===t){x.push(t);if(v.GROUP){$(v.GROUP).each(function(z,y){x.push(y.TABLENAME)})}break}}return x}function c(u){var t;var x=p.LAYER;for(var v=0;v<x.length;v++){var w=x[v];if(w.TABLENAME===u){t=w;break}}return t}function b(t){$("#layer_switch_Nav span.checkbox").each(function(){var u=$(this);var v=u.attr("layer");if(v){if(t.indexOf(v)>-1){h(v);u.parent().parent().addClass("ischecked")}else{j(v);u.parent().parent().removeClass("ischecked")}}})}return{init:n,getMap:g,getLayerByName:a,showLayer:h,hideLayer:j,getLayerConfig:c,switchLayer:b}});